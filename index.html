<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Immria (Novus)</title>
    <meta name="description" content="Hello, World! - A-Frame">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <!-- <script src="https://unpkg.com/aframe-teleport-controls/dist/aframe-teleport-controls.min.js"></script> -->
    <!-- <script src="https://unpkg.com/aframe-input-mapping-component/dist/aframe-input-mapping-component.min.js"></script>  -->
    <script src="vendor/aframe-input-mapping-component.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls@0.3.0/src/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-tooltip-component@0.1.2/dist/aframe-tooltip-component.min.js"></script>
    <script src="./common/mappings.js"></script>
    <script type="text/javascript" language="javascript">
      AFRAME.registerComponent('monument-collection', {
        init: function () {
          // Code here.
          console.log('Welcome, class!');

          // Set up request to retrieve names from API endpoint
          var serverApiUrl = "https://pjrbfk87db.execute-api.us-east-1.amazonaws.com/dev/";
          var apiGetNames = "items";
          var namesUrl = serverApiUrl + apiGetNames;
          var dict = {};

          // // Send Request and Parse JSON Response
          // var request = new XMLHttpRequest();
          // request.responseType = 'json';
          // request.open('GET', namesUrl, true);

          // request.onload  = function() {
          //   var jsonResponse = request.response;
          //   // Error Checking Request
          //   if (request.status >= 200 && request.status < 400) {
          //     jsonResponse.forEach(name => {
          //       var tokenId = name["tokenId"];
          //       var addressName = name["addressName"]
          //       dict[tokenId] = addressName;
          //     })

              var sceneEl = document.querySelector('a-scene'); 
              for (var i = 0; i < 100; i++) {
                  // var boxEl = document.createElement('a-box');
                  // boxEl.setAttribute('material', {color: '#173852'});
                  // boxEl.setAttribute('position', {x: i, y: i, z: i});
                  // //boxEl.setAttribute('scale', {x: Math.random() / 2, y: Math.random() / 2, z: Math.random() / 2});
                  // sceneEl.appendChild(boxEl);

                  var textEl = document.createElement('a-entity');
                  var textPosX = (Math.floor(i/10)*2)-7.5;
                  var textPosY = 5 - (i%10)*0.3;
                  var textPosZ = -10 + 0.25;
                  var textValue = 'Alice Kisaragi';
                  // var textValue = dict[i];
                  console.log(dict[i]);
                  textEl.setAttribute('geometry', {width: 'auto', height: 'auto'});
                  textEl.setAttribute('position', {x: textPosX, y: textPosY, z: textPosZ}); 
                  textEl.setAttribute('text', {width:'5', value: textValue, whiteSpace: 'nowrap'});
                  sceneEl.appendChild(textEl);
                }

          //   } else {
          //     console.log('error')
          //   }
          // };
          // request.send(null);          
         }
      });
    
      AFRAME.registerComponent('code-to-attach-to-box', {
        init: function () {
          // Code here.
          console.log(this.el);
        }
      });
    </script>
  </head>
  <body>
    <a-scene monument-collection>
      <!-- Assets  -->
      <a-assets>
        <!-- <img id="boxTexture" src="assets/stones.jpg"> -->
        <img id="skyTexture"
          src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg">
          <a-asset-item id="hitEntityObj" src="assets/models/teleportHitEntity.obj"></a-asset-item>
      </a-assets>    

      <!-- Scene Geometry -->
      <a-entity id="bgm" sound="src: url(assets/human-village.mp3); autoplay: true; volume: 0.1; loop: true; positional: false">
      </a-entity>
      <a-plane color="#505559" rotation="-90 0 0" width="50" height="50"></a-plane>
      <a-sky src="#skyTexture"></a-sky>

      <!-- hand controls -->
      <!-- <a-entity teleport-controls="startEvents: teleportstart; endEvents: teleportend"
        vive-controls="hand: left"
        oculus-touch-controls="hand: left"
        microsoft-motion-controls="hand: left"
        daydream-controls="left" gearvr-controls="left">
      </a-entity>
      <a-entity teleport-controls="startEvents: teleportstart; endEvents: teleportend; type: line"
        vive-controls="hand: right"
        microsoft-motion-controls="hand: right"
        oculus-touch-controls="hand: right"
        daydream-controls="right" gearvr-controls="right">
      </a-entity> -->
      
      <!-- hand controls -->
      <a-entity id="hitEntityLeft" material="shader:flat; color: #ff3468" obj-model="obj: #hitEntityObj"></a-entity>
      <a-entity id="hitEntityRight" material="shader:flat; color: #ff3468" obj-model="obj: #hitEntityObj"></a-entity>
      <a-entity id="cameraRig">
        <!-- camera -->
        <a-entity id="acamera" camera></a-entity>
        <!-- hand controls -->
        <a-entity id="left-hand"
        oculus-touch-controls="hand: left"
                  brush
                  paint-controls="hand: left"
                  blink-controls="cameraRig: #cameraRig; startEvents: aim; endEvents: teleport; hitCylinderColor: #ff3468; curveHitColor: #ff3468; curveMissColor: #333333; curveLineWidth: 0.01; hitEntity: #hitEntityLeft"
                  ui>
        </a-entity>
        <a-entity id="right-hand"
        oculus-touch-controls="hand: right"
                  brush
                  paint-controls="hand: right"
                  blink-controls="cameraRig: #cameraRig; startEvents: aim; endEvents: teleport; hitCylinderColor: #ff3468; curveHitColor: #ff3468; curveMissColor: #333333; curveLineWidth: 0.01; hitEntity: #hitEntityRight"
                  ui>
        </a-entity>
      </a-entity>

      <!-- <a-entity id="teleHand" hand-controls="hand: left" teleport-controls="type: parabolic; collisionEntities: [mixin='voxel'], #ground"></a-entity>
      <a-entity id="blockHand" hand-controls="hand: right"></a-entity>  -->

      <!-- Components -->
        <!-- Main Monument -->
        <a-box 
          color="#173852"
          position="-0.1 3.65 -10" 
          rotation="0 0 0"
          scale="20 3.2 0.25" 
        >
        </a-box>
          <!-- Main Feet -->
          <a-box 
            color="#173852"
            position="5 1.75 -10" 
            scale="1 1 .25" 
          >
          </a-box>
          <a-box 
            color="#173852"
            position="-5 1.75 -10" 
            scale="1 1 .25" 
          >
          </a-box>
          <!-- Main Stairs -->
          <a-box 
            color="#354654"
            position="0 0 -10" 
            scale="22.5 3 1.5" 
          >
          </a-box>
          <a-box 
            color="#424F59"
            position="0 -.5 -10" 
            scale="23 3 2" 
          >
          </a-box>
          <a-box 
            color="#4A5259"
            position="0 -1 -10" 
            scale="23.5 3 2.5" 
          >
          </a-box>

        <!-- Walls -->
        <a-box 
          color="#343737"
          position="-0.1 5 -25," 
          rotation="0 0 0"
          scale="50 10 0.25" 
        >
        </a-box>
        <a-box 
          color="#343737"
          position="25 5 0," 
          rotation="0 90 0"
          scale="50 10 0.25" 
        >
        </a-box>
        <a-box 
          color="#343737"
          position="-25 5 0," 
          rotation="0 90 0"
          scale="50 10 0.25" 
        >
        </a-box>

    </a-scene>
  </body>
</html>